services:
  # Development container with VNC (Mac/Windows/Jetson)
  ros-dev:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    container_name: gerbil-dev
    ports:
      - "6080:80"
    shm_size: '512m'
    security_opt:
      - seccomp:unconfined
    volumes:
      - .:/home/ubuntu/ros2_ws/src/gerbil-software
    devices:
      - /dev/ttyTHS1:/dev/ttyTHS1  # RoboClaw (only exists on Jetson, ignored on Mac)
      # - /dev/video0:/dev/video0    # ZED2i (only exists on Jetson, ignored on Mac)
      - /dev/i2c-1:/dev/i2c-1      # IMU (only exists on Jetson, ignored on Mac)
    command: /bin/bash -c "supervisord -c /etc/supervisor/supervisord.conf"

  # Headless container (Jetson only)
  ros-jetson:
    build:
      context: .
      dockerfile: docker/Dockerfile.jetson
    container_name: gerbil-jetson
    network_mode: host
    privileged: true
    shm_size: '512m'
    volumes:
      - .:/home/ubuntu/ros2_ws/src/gerbil-software
    devices:
      - /dev/ttyTHS1:/dev/ttyTHS1
      - /dev/video0:/dev/video0
      - /dev/i2c-1:/dev/i2c-1
    command: /bin/bash -c "tail -f /dev/null"
